<!DOCTYPE html> 
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6 lt8"> <![endif]--> 
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7 lt8"> <![endif]--> 
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8 lt8"> <![endif]--> 
<!--[if IE 9 ]>    <html lang="en" class="no-js ie9"> <![endif]--> 
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]--> 
    <head> 
        <meta charset="UTF-8" /> 
        <!-- <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">  --> 
        <title>Login and Registration Form with HTML5 and CSS3 Demo</title> 
        <meta name="viewport" content="width=device-width, initial-scale=1.0">  
        <meta name="description" content="Login and Registration Form with HTML5 and CSS3" /> 
        <meta name="keywords" content="html5, css3, form, switch, animation, :target, pseudo-class" /> 
        <link rel="stylesheet" type="text/css" href="css/demo.css" /> 
        <link rel="stylesheet" type="text/css" href="css/style2.css" /> 
        <link rel="stylesheet" type="text/css" href="css/animate-custom.css" /> 
        <script type="text/javascript" src="js/jquery-1.8.3.js"></script> 
        <script type="text/javascript" src="js/jquery.popImage.mini.js"></script>    
        <link href="index.css" rel="stylesheet" type="text/css"> 
        <script language="javascript"> 
window.addEventListener("DOMContentLoaded", function() { 
    var timer; 
    var canvas = document.getElementById("canvas"), 
    context = canvas.getContext("2d"), 
        video = document.getElementById("video"), 
        videoObj = { "video": true }, 
        errBack = function(error) { 
            console.log("Video capture error: ", error.code);  
        }; 
    if(navigator.getUserMedia) { // Standard 
        navigator.getUserMedia(videoObj, function(stream) { 
            video.src = stream; 
            video.play(); 
        }, errBack); 
    } else if(navigator.webkitGetUserMedia) { // WebKit-prefixed 
        navigator.webkitGetUserMedia(videoObj, function(stream){ 
            video.src = window.webkitURL.createObjectURL(stream); 
            video.play(); 
        }, errBack); 
    } 
    document.getElementById("snap").addEventListener("click", function() { 
        clearTimeout(timer); 
        video.pause(); 
    }); 
    document.getElementById("rephotograph").addEventListener("click", function() { 
        clearTimeout(timer); 
        video.play(); 
    }); 
    document.getElementById("autophotograph").addEventListener("click",function(){ 
        video.play(); 
        timer = setTimeout(function(){   
            video.pause(); 
        },3000); 
    }); 
    document.getElementById("change").addEventListener("click", function() { 
        context.drawImage(video, 0, 0, 440, 330); 
    }); 
   
    var saveFile = function(data, filename) { 
        var save_link = document.createElementNS('http://www.w3.org/1999/xhtml', 'a'); 
        save_link.href = data; 
        save_link.download = filename; 
        var event = document.createEvent('MouseEvents'); 
        event.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null); 
        save_link.dispatchEvent(event); 
    }; 
    document.getElementById("download").addEventListener("click", function() { 
        var myCanvas = document.getElementById("canvas");   
   
        var image = myCanvas.toDataURL("image/png").replace("image/png", "image/octet-stream");    
        var filename = 'paint_' + (new Date()).getTime() + '.png'; 
        saveFile(image,filename); 
        // window.location.href=image; // it will save locally   
    }); 
}, false); 
   
</script> 
    </head> 
    <body> 
        <div class="container" id="container"> 
            <section>              
                <div id="container_demo" > 
                    <!-- hidden anchor to stop jump http://www.css3create.com/Astuce-Empecher-le-scroll-avec-l-utilisation-de-target#wrap4  --> 
                    <a class="hiddenanchor" id="toregister"></a>                                 
   
                    <a class="hiddenanchor" id="tologin"></a> 
                    <div id="wrapper"> 
   
                        <div id="login" class="animate form"> 
                            <h1>自拍一下</h1> 
                                <div> 
                                <video id="video" width="440" height="330" autoplay></video> 
                                </div> 
                                    <a id="snap" class="normal_button">拍照</a> 
                                    <a id="autophotograph" class="normal_button">5秒后自动拍摄</a> 
                                    <a id="rephotograph" class="normal_button">重拍</a> 
                                    <a href="#toregister" id="change" class="to_register">修改</a> 
        <a href="http://www.sae.sina.com.cn">sae站点</a> 
   
                        </div> 
                       <div id="register" class="animate form"> 
                                <h1> 修改一下</h1>  
                                 <canvas id="canvas" name="mypic" width="440" height="330"></canvas> 
                     <div id="chooseColor"></div> 
                                <div id="chooseSize"></div><br><br> 
                                <div> 
                                <a id="download" class="normal_button">下载到本地</a> 
                                <a id="share" class="normal_button">分享到本网站</a> 
                                <a href="paint/show.php" class="to_register" target="_blank"> 查看他人分享 </a> 
                                <a href="#tologin" class="to_register"> 重新拍摄 </a> 
                                            <a href="http://www.sae.sina.com.cn">sae站点</a> 
                                </div> 
                        </div>         
                    </div> 
                </div>   
            </section> 
        </div> 
    </body> 
<script> 
   $("#download").click(function() { 
    var myCanvas = document.getElementById("canvas"); 
    var image = myCanvas.toDataURL("image/png").replace("image/png", "image/octet-stream"); 
    // window.location.href=image; 
    var filename = 'paint_' + (new Date()).getTime() + '.png'; 
    //saveFile(image, filename); 
       
    var save_link = document.createElementNS('http://www.w3.org/1999/xhtml', 'a'); 
    save_link.href = image; 
    save_link.download = filename; 
    var event = document.createEvent('MouseEvents'); 
    event.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null); 
  //  save_link.dispatchEvent(event); 
});
</script> 
</html>